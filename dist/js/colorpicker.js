/*! (c) Philipp KÃ¶nig under Apache 2.0 */
window.Colorpicker=(()=>{"use strict";function t(){this.r=0,this.g=0,this.b=0,this.a=1,this.hue=0,this.saturation=0,this.value=0;let t=t=>"number"==typeof t&&!1===isNaN(t),e=(e,i,s,a)=>{t(e)&&t(i)&&t(s)&&(this.r=Math.max(0,Math.min(255,0|e)),this.g=Math.max(0,Math.min(255,0|i)),this.b=Math.max(0,Math.min(255,0|s)),!0===t(a)&&(this.a=Math.max(0,Math.min(1,a))))},i=t=>{let i=t.match(/(\d*\.\d*|\d+)/g);3===i.length&&i.push(1),4===i.length&&(e(...i.map(t=>+t)),l())},s=t=>{/(^#{0,1}[0-9A-F]{6}$)|(^#{0,1}[0-9A-F]{3}$)/i.test(t)&&("#"===t[0]&&(t=t.slice(1,t.length)),3===t.length&&(t=t.replace(/([0-9A-F])([0-9A-F])([0-9A-F])/i,"$1$1$2$2$3$3")),this.r=parseInt(t.substr(0,2),16),this.g=parseInt(t.substr(2,2),16),this.b=parseInt(t.substr(4,2),16),this.a=1,l())},a=()=>{let t=this.saturation/100,i=this.value/100,s=t*i,a=this.hue/60,l=s*(1-Math.abs(a%2-1)),h=i-s;s=255*(s+h)|0,l=255*(l+h)|0,h=255*h|0,a>=0&&a<1?e(s,l,h):a>=1&&a<2?e(l,s,h):a>=2&&a<3?e(h,s,l):a>=3&&a<4?e(h,l,s):a>=4&&a<5?e(l,h,s):a>=5&&a<6&&e(s,h,l)},l=()=>{let t=this.r/255,e=this.g/255,i=this.b/255,s=Math.max(t,e,i),a=s-Math.min(t,e,i),l=0,h=0;a&&(s===t&&(l=(e-i)/a),s===e&&(l=2+(i-t)/a),s===i&&(l=4+(t-e)/a),s&&(h=a/s)),this.hue=60*l|0,this.hue<0&&(this.hue+=360),this.saturation=100*h|0,this.value=100*s|0};this.setFromRaw=(t=>{"transparent"===(t=t.trim())?(this.r=0,this.g=0,this.b=0,this.a=0,l()):/(^#{0,1}[0-9A-F]{6}$)|(^#{0,1}[0-9A-F]{3}$)/i.test(t)?s(t):/^rgba?\([^)]+\)$/i.test(t)&&i(t)}),this.setByName=((e,i)=>{if(("r"===e||"g"===e||"b"===e||"a"===e)&&t(i)){let t=1;"a"!==e&&(i|=0,t=255),this[e]=Math.max(0,Math.min(t,i)),l()}}),this.setHSV=((e,i,s)=>{t(e)&&t(i)&&t(s)&&(this.hue=Math.max(0,Math.min(360,e)),this.saturation=Math.max(0,Math.min(100,i)),this.value=Math.max(0,Math.min(100,s)),a())}),this.setHue=(e=>{t(e)&&(this.hue=Math.max(0,Math.min(360,e)),a())}),this.getHex=(()=>{let t=this.r.toString(16),e=this.g.toString(16),i=this.b.toString(16);return this.r<16&&(t="0"+t),this.g<16&&(e="0"+e),this.b<16&&(i="0"+i),("#"+t+e+i).toLowerCase()}),this.getColor=(()=>{if(!1|this.a)return this.getHex();let t="("+this.r+","+this.g+","+this.b,e="",i="",s=parseFloat(this.a);return 1!==s&&(e="a",i=","+s),"rgb"+e+t+i+")"})}return function(e,i){i=i||{};let s=null,a=null,l=null,h=[],r={};this.color=new t;let o=(t,e)=>{t.addEventListener("mousedown",t=>{e(t),document.addEventListener("mousemove",e)}),document.addEventListener("mouseup",t=>{document.removeEventListener("mousemove",e)})},n=()=>{(s=document.createElement("div")).className="color-picker",document.body.appendChild(s),(a=document.createElement("span")).className="color-preview",e.parentNode.insertBefore(a,e.nextSibling),a.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),[].forEach.call(document.getElementsByClassName("color-picker"),t=>{t.classList.remove("visible")}),s.classList.add("visible"),this.reposition(),f("show"),u()}),document.addEventListener("click",t=>{t.target===s||s.contains(t.target)||this.close()})},c=()=>{let t=document.createElement("div"),e=document.createElement("div");t.className="picking-area",e.className="picker",this.pickingArea=t,this.colorPicker=e,o(t,t=>{let e=this.pickingArea.getBoundingClientRect(),i=this.pickingArea.clientWidth,s=[t.pageX-e.left,t.pageY-e.top];s.forEach((t,e)=>{t>i&&(t=i),t<0&&(t=0),s[e]=t});let a=100*s[0]/i|0,l=100-100*s[1]/i|0;this.color.setHSV(this.color.hue,a,l),this.colorPicker.style.left=s[0]-5+"px",this.colorPicker.style.top=s[1]-5+"px",x(),C(),E()}),t.appendChild(e),s.appendChild(t)},d=()=>{let t=document.createElement("div"),e=document.createElement("div");t.className="hue",e.className="slider-picker",this.hueArea=t,this.huePicker=e,o(t,t=>{let e=this.hueArea.getBoundingClientRect(),i=Math.max(0,t.pageX-e.left),s=this.hueArea.clientWidth;i>s&&(i=s),this.huePicker.style.left=Math.max(i-3,-2)+"px",this.color.setHue(359*i/s|0),u()}),t.appendChild(e),s.appendChild(t)},m=()=>{let t=document.createElement("div"),e=document.createElement("div"),i=document.createElement("div");t.className="alpha",e.className="alpha-mask",i.className="slider-picker",l={area:t,mask:e,picker:i},o(t,t=>{let e=l.area.getBoundingClientRect(),i=t.pageX-e.left,s=l.area.clientWidth;i<0&&(i=0),i>s&&(i=s),this.color.setByName("a",+(i/s).toFixed(2)),l.picker.style.left=Math.max(i-3,-2)+"px",C(),E()}),t.appendChild(e),e.appendChild(i),s.appendChild(t)},p=(t,e)=>{let i=document.createElement("div"),a=document.createElement("input"),l=document.createElement("span");i.className="input-"+t,l.textContent=t,a.setAttribute("type","text"),i.appendChild(l),i.appendChild(a),s.appendChild(i),a.addEventListener("change",e),h[t]=(t=>{a.value=t})},u=()=>{E(),v(),k(),g(),b(),x(),C()},g=()=>{let t=this.pickingArea.clientWidth,e=this.color.value,i=this.color.saturation*t/100|0,s=t-e*t/100|0;this.colorPicker.style.left=i-5+"px",this.colorPicker.style.top=s-5+"px"},v=()=>{let t=this.hueArea.clientWidth,e=this.color.hue*t/360|0;this.huePicker.style.left=e-1+"px"},b=()=>{if(l){let t=l.area.clientWidth,e=this.color.a*t|0;l.picker.style.left=e-1+"px"}},k=()=>{let e=new t;e.setHSV(this.color.hue,100,100),this.pickingArea.style.backgroundColor=e.getHex()},x=()=>{l&&(l.mask.style.background="linear-gradient(to right, transparent 0%,"+this.color.getHex()+" 100%)")},C=()=>{e.value=this.color.getColor(),a.style.backgroundColor=this.color.getColor(),f("change")},f=t=>{void 0!==r[t]&&r[t].forEach(t=>{t({color:this.color.getColor(),colorObj:this.color,elm:this.getElements()})})},E=()=>{M("r",this.color.r),M("g",this.color.g),M("b",this.color.b),M("a",this.color.a),M("color",this.color.getColor())},M=(t,e)=>{h[t]&&h[t](e)};this.setColor=(t=>{this.color.setFromRaw(t),u()}),this.getColorObj=(()=>this.color),this.getElements=(()=>({wrapper:s,preview:a,field:e})),this.reposition=(()=>{if(s.classList.contains("visible")){let t=a.getBoundingClientRect();s.style.top=t.top+a.offsetHeight+"px",s.style.left=t.left+"px"}}),this.close=(()=>{s.classList.contains("visible")&&(f("hide"),s.classList.remove("visible"))}),this.on=((t,e)=>{void 0===r[t]&&(r[t]=[]),r[t].push(e)}),(()=>{n(),c(),d();let t=["r","g","b"];i.alpha&&(m(),t.push("a")),t.forEach(t=>{p(t,e=>{let i=e.target.value;i="a"===t?+i.replace(/\,/g,"."):parseInt(i),this.color.setByName(t,i),e.target.value=this.color[t],u()})}),p("color",t=>{let e=t.target.value;this.color.setFromRaw(e),u()}),u()})()}})();